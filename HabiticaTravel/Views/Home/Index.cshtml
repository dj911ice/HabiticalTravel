@{
    ViewBag.Title = "Home Page";
    //Layout = "~/Views/Shared/_ProfileLayout.cshtml";
}

@Styles.Render("~/Content/Habitica")
@Html.Partial("_ProfileLayout")


@*<div class="modal fade delete-task-modal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content text-center">
            <h3>Are you sure you want to delete this item?</h3>
            <p>Deleting this item is permanent, there is no going back, click Remove to delete item, or click out of this box to cancel.</p><br />
            <a name="taskId" class="index-button remove">Remove</a>
        </div>
    </div>
</div>*@

<button class="btn-success" id="reminderHandler">CheckReminders</button>
<div class="container-fluid text-center">
    @if (ViewBag.Tasks.Count == 0)
    {
        <h1>Currently no tasks</h1>
    }
    else
    {
        <div class="container-fluid">
            <div class="row">
                @foreach (var task in ViewBag.Tasks)
                {
                <div class="col-xs-4">
                    <div class="task-item">
                        <h3>@task.TaskName</h3>
                        <h5>@task.TaskType</h5>
                        <p>@task.TaskNotes</p><br />
                    </div>
                    <div class="task-links">
                        <a href="/Tasks/ViewTask?TaskId=@task.TaskId">Details</a>
                        <a href="/Tasks/RemoveTask?taskId=@task.TaskId">Remove Task</a>
                        <a href="/Tasks/EditCustomTask?taskId=@task.TaskId">Edit Task</a>
                    </div>
                </div>
                }
            </div>
        </div>

    }
</div>



@section Scripts
{
    <script src="~/Scripts/HabiticaJavaScript/DeleteTasksModal.js"></script>
    <script>
        $(function () {

            $("#btnRedirect").click(function(){
                window.location.href = "@Url.Action("Index","Home")";
            });

            $("#reminderHandler").on("click", () => {
            function msToTime(duration) {
                var milliseconds = parseInt((duration % 1000) / 100)
                    , seconds = parseInt((duration / 1000) % 60)
                    , minutes = parseInt((duration / (1000 * 60)) % 60)
                    , hours = parseInt((duration / (1000 * 60 * 60)) % 24);

                hours = (hours < 10) ? "0" + hours : hours;
                minutes = (minutes < 10) ? "0" + minutes : minutes;
                seconds = (seconds < 10) ? "0" + seconds : seconds;

                return `${hours}:${minutes}:${seconds}.${milliseconds}`;
            };
            let dates = @Html.Raw(Json.Encode(ViewBag.EndDates));
            let alertTime = dates.map(d => new Date(parseInt(d.replace(/[^0-9 +]/g, ''))) - new Date());
            for (let i = 0; i < alertTime.length; i++) {
                if (alertTime[i] <= 86400000 && alerTime[i] > 0) {
                    alert(`Time left for task: ${msToTime(alertTime[i])}`);
                }
                else if (alertTime[i] < 0) {
                    alert('The time has already come');
                }
            }
        })
    });
    </script>
}

