@{
    ViewBag.Title = "Home Page";
    //Layout = "~/Views/Shared/_ProfileLayout.cshtml";
}

@Styles.Render("~/Content/Habitica")
@Html.Partial("_ProfileLayout")


<div class="modal fade delete-task-modal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content text-center">
            <h3>Are you sure you want to delete this item?</h3>
            <p>Deleting this item is permanent, there is no going back, click Remove to delete item, or click out of this box to cancel.</p><br />
            <a name="taskId" class="index-button remove">Remove</a>
        </div>
    </div>
</div>

<button class="btn-success" id="reminderHandler">CheckReminders</button>
<div class="container-fluid text-center">
    @if (ViewBag.Tasks == null)
    {
        <h1>Currently no tasks</h1>
    }
    else
    {
        <div class="container-fluid">
            <div class="row">
                @foreach (var task in ViewBag.Tasks)
                {
                    <div class="col-xs-4">
                        <div class="task-item">
                            <h3>@task.TaskName</h3>
                            <h5>@task.TaskType</h5>
                            <p>@task.TaskNotes</p><br />
                            <a href="/Tasks/ViewTask?TaskId=@task.TaskId">Details</a>
                            <a href="#" data-target=".delete-task-modal" data-toggle="modal" class="index-button remove" data-item-id="/Tasks/RemoveTask?taskId=@task.TaskId">Delete</a>
                            <a href="/Tasks/EditCustomTask?taskId=@task.TaskId">Edit</a>
                        </div>
                    </div>
                }
            </div>
        </div>

    }
</div>


<script>

    $(function () {
        $("#reminderHandler").click(function () {
            var array = @Html.Raw(Json.Encode(@ViewBag.EndDates));
            var dates = [];
            for(var i = 0; i < array.length; i++) {
                dates[i] = array[i];
            }
            console.log(dates);
            var milliseconds = [];
            for (var i = 0; i < dates.length; i++) {
                milliseconds[i] = dates[i] - (@DateTime.Now).TotalMilliseconds;
            }

            console.log("test");
            alert("clicked");
            for (var i = 0; i < milliseconds.length; i++) {
                if (milliseconds > 0) {
                    alert('Your task will be due on ' + str(milliseconds[i]));
                }
                else {
                    alert('The time has already come');
                }
            }
        })
    });


    var date = TaskDate
    var milliseconds = (TaskDate - DateTime.Now).TotalMilliseconds
    $(document).ready(function(){
        if(milliseconds > 0){
            alert('Your task will be due on ' + str(date));
            window.setTimeout(function(){
                alert('Time has come');
                //Or any other thing you might want to do
            }, milliseconds);
        }
        else{
            alert('The time has already come');
        }
    }

</script>